<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinanceTracker - Controle de Despesas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Poppins', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .income-card {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .expense-card {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .balance-card {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }
        
        .animate-slide-up {
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .category-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .modal-overlay {
            backdrop-filter: blur(5px);
            background: rgba(0, 0, 0, 0.5);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .expense-item {
            border-left: 4px solid transparent;
            transition: all 0.3s ease;
        }
        
        .expense-item:hover {
            border-left-color: #667eea;
            background-color: #f8fafc;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white py-6">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <img src="https://placehold.co/60x60" alt="FinanceTracker logo with dollar sign and graph icon in modern white style" class="rounded-full">
                    <div>
                        <h1 class="text-2xl font-bold">FinanceTracker</h1>
                        <p class="text-white/80">Controle suas finan√ßas com intelig√™ncia</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-white/80 text-sm">√öltimo update</p>
                    <p class="font-semibold" id="last-update">Hoje</p>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Cards de Resumo -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="income-card rounded-xl p-6 text-white card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-white/80 text-sm">Receitas</p>
                        <p class="text-2xl font-bold" id="total-income">R$ 0,00</p>
                        <p class="text-white/70 text-xs mt-1">Este m√™s</p>
                    </div>
                    <div class="bg-white/20 p-3 rounded-lg">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.293l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z"/>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="expense-card rounded-xl p-6 text-white card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-white/80 text-sm">Despesas</p>
                        <p class="text-2xl font-bold" id="total-expenses">R$ 0,00</p>
                        <p class="text-white/70 text-xs mt-1">Este m√™s</p>
                    </div>
                    <div class="bg-white/20 p-3 rounded-lg">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v3.586L7.707 9.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 10.586V7z"/>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="balance-card rounded-xl p-6 text-white card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-white/80 text-sm">Saldo</p>
                        <p class="text-2xl font-bold" id="total-balance">R$ 0,00</p>
                        <p class="text-white/70 text-xs mt-1" id="balance-status">Equilibrado</p>
                    </div>
                    <div class="bg-white/20 p-3 rounded-lg">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Formul√°rio e Filtros -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Adicionar Transa√ß√£o -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Nova Transa√ß√£o</h2>
                    <form id="transaction-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tipo</label>
                            <select id="transaction-type" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="expense">Despesa</option>
                                <option value="income">Receita</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o</label>
                            <input type="text" id="transaction-description" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ex: Almo√ßo, Sal√°rio, Compras" required>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Valor (R$)</label>
                            <input type="number" id="transaction-amount" step="0.01" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0,00" required>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                            <select id="transaction-category" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="alimentacao">üçΩÔ∏è Alimenta√ß√£o</option>
                                <option value="transporte">üöó Transporte</option>
                                <option value="moradia">üè† Moradia</option>
                                <option value="saude">üè• Sa√∫de</option>
                                <option value="educacao">üìö Educa√ß√£o</option>
                                <option value="lazer">üéÆ Lazer</option>
                                <option value="trabalho">üíº Trabalho</option>
                                <option value="outros">üì¶ Outros</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Data</label>
                            <input type="date" id="transaction-date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>

                        <button type="submit" class="w-full gradient-bg text-white font-semibold py-3 px-6 rounded-lg hover:opacity-90 transition-opacity">
                            Adicionar Transa√ß√£o
                        </button>
                    </form>
                </div>

                <!-- Filtros -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Filtros</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Per√≠odo</label>
                            <select id="period-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <option value="all">Todos</option>
                                <option value="today">Hoje</option>
                                <option value="week">Esta Semana</option>
                                <option value="month">Este M√™s</option>
                                <option value="year">Este Ano</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tipo</label>
                            <select id="type-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <option value="all">Todos</option>
                                <option value="income">Receitas</option>
                                <option value="expense">Despesas</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                            <select id="category-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <option value="all">Todas</option>
                                <option value="alimentacao">üçΩÔ∏è Alimenta√ß√£o</option>
                                <option value="transporte">üöó Transporte</option>
                                <option value="moradia">üè† Moradia</option>
                                <option value="saude">üè• Sa√∫de</option>
                                <option value="educacao">üìö Educa√ß√£o</option>
                                <option value="lazer">üéÆ Lazer</option>
                                <option value="trabalho">üíº Trabalho</option>
                                <option value="outros">üì¶ Outros</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gr√°ficos e Transa√ß√µes -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Gr√°ficos -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Despesas por Categoria</h3>
                        <div class="chart-container">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Evolu√ß√£o Mensal</h3>
                        <div class="chart-container">
                            <canvas id="monthlyChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Lista de Transa√ß√µes -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Transa√ß√µes Recentes</h3>
                        <div class="flex space-x-2">
                            <button onclick="exportData()" class="px-4 py-2 bg-green-500 text-white rounded-lg text-sm hover:bg-green-600 transition-colors">
                                Exportar
                            </button>
                            <button onclick="clearAllData()" class="px-4 py-2 bg-red-500 text-white rounded-lg text-sm hover:bg-red-600 transition-colors">
                                Limpar Tudo
                            </button>
                        </div>
                    </div>
                    <div class="space-y-2 max-h-96 overflow-y-auto" id="transactions-list">
                        <div class="text-center py-8 text-gray-500">
                            <img src="https://placehold.co/200x150" alt="Empty wallet illustration with coins and dollar bills in modern flat design style" class="mx-auto mb-4 rounded-lg">
                            <p>Nenhuma transa√ß√£o ainda. Adicione sua primeira movimenta√ß√£o!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Edi√ß√£o -->
    <div id="edit-modal" class="fixed inset-0 modal-overlay hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md mx-4">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Editar Transa√ß√£o</h3>
            <form id="edit-form" class="space-y-4">
                <input type="hidden" id="edit-id">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Tipo</label>
                    <select id="edit-type" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        <option value="expense">Despesa</option>
                        <option value="income">Receita</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o</label>
                    <input type="text" id="edit-description" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Valor (R$)</label>
                    <input type="number" id="edit-amount" step="0.01" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                    <select id="edit-category" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        <option value="alimentacao">üçΩÔ∏è Alimenta√ß√£o</option>
                        <option value="transporte">üöó Transporte</option>
                        <option value="moradia">üè† Moradia</option>
                        <option value="saude">üè• Sa√∫de</option>
                        <option value="educacao">üìö Educa√ß√£o</option>
                        <option value="lazer">üéÆ Lazer</option>
                        <option value="trabalho">üíº Trabalho</option>
                        <option value="outros">üì¶ Outros</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Data</label>
                    <input type="date" id="edit-date" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                </div>
                <div class="flex space-x-3">
                    <button type="submit" class="flex-1 bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors">
                        Salvar
                    </button>
                    <button type="button" onclick="closeEditModal()" class="flex-1 bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Dados e configura√ß√µes
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let categoryChart, monthlyChart;

        // Elementos do DOM
        const transactionForm = document.getElementById('transaction-form');
        const editForm = document.getElementById('edit-form');
        const transactionsList = document.getElementById('transactions-list');
        const editModal = document.getElementById('edit-modal');

        // Configurar data padr√£o para hoje
        document.getElementById('transaction-date').value = new Date().toISOString().split('T')[0];

        // Event Listeners
        transactionForm.addEventListener('submit', addTransaction);
        editForm.addEventListener('submit', updateTransaction);
        document.getElementById('period-filter').addEventListener('change', applyFilters);
        document.getElementById('type-filter').addEventListener('change', applyFilters);
        document.getElementById('category-filter').addEventListener('change', applyFilters);

        // Inicializar aplica√ß√£o
        updateSummary();
        renderTransactions();
        initCharts();
        updateLastUpdate();

        function addTransaction(e) {
            e.preventDefault();
            
            const transaction = {
                id: Date.now(),
                type: document.getElementById('transaction-type').value,
                description: document.getElementById('transaction-description').value,
                amount: parseFloat(document.getElementById('transaction-amount').value),
                category: document.getElementById('transaction-category').value,
                date: document.getElementById('transaction-date').value,
                createdAt: new Date().toISOString()
            };

            transactions.unshift(transaction);
            saveTransactions();
            updateSummary();
            renderTransactions();
            updateCharts();
            transactionForm.reset();
            document.getElementById('transaction-date').value = new Date().toISOString().split('T')[0];
            
            showNotification('Transa√ß√£o adicionada com sucesso!', 'success');
        }

        function renderTransactions() {
            const filteredTransactions = getFilteredTransactions();
            
            if (filteredTransactions.length === 0) {
                transactionsList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <img src="https://placehold.co/200x150" alt="No transactions found illustration with empty calculator and coins scattered around in modern flat design" class="mx-auto mb-4 rounded-lg">
                        <p>Nenhuma transa√ß√£o encontrada com os filtros aplicados.</p>
                    </div>
                `;
                return;
            }

            transactionsList.innerHTML = filteredTransactions.map(transaction => {
                const categoryIcons = {
                    alimentacao: 'üçΩÔ∏è',
                    transporte: 'üöó',
                    moradia: 'üè†',
                    saude: 'üè•',
                    educacao: 'üìö',
                    lazer: 'üéÆ',
                    trabalho: 'üíº',
                    outros: 'üì¶'
                };

                const categoryNames = {
                    alimentacao: 'Alimenta√ß√£o',
                    transporte: 'Transporte',
                    moradia: 'Moradia',
                    saude: 'Sa√∫de',
                    educacao: 'Educa√ß√£o',
                    lazer: 'Lazer',
                    trabalho: 'Trabalho',
                    outros: 'Outros'
                };

                return `
                    <div class="expense-item animate-slide-up flex items-center justify-between p-4 rounded-lg">
                        <div class="flex items-center space-x-4">
                            <div class="category-icon bg-gray-100">
                                ${categoryIcons[transaction.category] || 'üì¶'}
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-800">${transaction.description}</h4>
                                <div class="flex items-center space-x-2 text-sm text-gray-600">
                                    <span>${categoryNames[transaction.category] || 'Outros'}</span>
                                    <span>‚Ä¢</span>
                                    <span>${formatDate(transaction.date)}</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="font-semibold ${transaction.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                                ${transaction.type === 'income' ? '+' : '-'} R$ ${transaction.amount.toFixed(2).replace('.', ',')}
                            </span>
                            <div class="flex space-x-1">
                                <button onclick="editTransaction(${transaction.id})" class="text-blue-500 hover:text-blue-700 p-1">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                                    </svg>
                                </button>
                                <button onclick="deleteTransaction(${transaction.id})" class="text-red-500 hover:text-red-700 p-1">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateSummary() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const monthlyTransactions = transactions.filter(t => {
                const transactionDate = new Date(t.date);
                return transactionDate.getMonth() === currentMonth && 
                       transactionDate.getFullYear() === currentYear;
            });

            const income = monthlyTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const expenses = monthlyTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const balance = income - expenses;

            document.getElementById('total-income').textContent = `R$ ${income.toFixed(2).replace('.', ',')}`;
            document.getElementById('total-expenses').textContent = `R$ ${expenses.toFixed(2).replace('.', ',')}`;
            document.getElementById('total-balance').textContent = `R$ ${balance.toFixed(2).replace('.', ',')}`;
            
            const balanceStatus = document.getElementById('balance-status');
            if (balance > 0) {
                balanceStatus.textContent = 'Positivo';
                balanceStatus.className = 'text-green-200 text-xs mt-1';
            } else if (balance < 0) {
                balanceStatus.textContent = 'Negativo';
                balanceStatus.className = 'text-red-200 text-xs mt-1';
            } else {
                balanceStatus.textContent = 'Equilibrado';
                balanceStatus.className = 'text-white/70 text-xs mt-1';
            }
        }

        function getFilteredTransactions() {
            const periodFilter = document.getElementById('period-filter').value;
            const typeFilter = document.getElementById('type-filter').value;
            const categoryFilter = document.getElementById('category-filter').value;
            
            return transactions.filter(transaction => {
                // Filtro de per√≠odo
                const transactionDate = new Date(transaction.date);
                const now = new Date();
                let periodMatch = true;
                
                switch(periodFilter) {
                    case 'today':
                        periodMatch = transactionDate.toDateString() === now.toDateString();
                        break;
                    case 'week':
                        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        periodMatch = transactionDate >= weekAgo;
                        break;
                    case 'month':
                        periodMatch = transactionDate.getMonth() === now.getMonth() && 
                                     transactionDate.getFullYear() === now.getFullYear();
                        break;
                    case 'year':
                        periodMatch = transactionDate.getFullYear() === now.getFullYear();
                        break;
                }
                
                // Filtro de tipo
                const typeMatch = typeFilter === 'all' || transaction.type === typeFilter;
                
                // Filtro de categoria
                const categoryMatch = categoryFilter === 'all' || transaction.category === categoryFilter;
                
                return periodMatch && typeMatch && categoryMatch;
            });
        }

        function applyFilters() {
            renderTransactions();
            updateCharts();
        }

        function editTransaction(id) {
            const transaction = transactions.find(t => t.id === id);
            if (!transaction) return;

            document.getElementById('edit-id').value = transaction.id;
            document.getElementById('edit-type').value = transaction.type;
            document.getElementById('edit-description').value = transaction.description;
            document.getElementById('edit-amount').value = transaction.amount;
            document.getElementById('edit-category').value = transaction.category;
            document.getElementById('edit-date').value = transaction.date;
            
            editModal.classList.remove('hidden');
            editModal.classList.add('flex');
        }

        function updateTransaction(e) {
            e.preventDefault();
            
            const id = parseInt(document.getElementById('edit-id').value);
            const transactionIndex = transactions.findIndex(t => t.id === id);
            
            if (transactionIndex !== -1) {
                transactions[transactionIndex] = {
                    ...transactions[transactionIndex],
                    type: document.getElementById('edit-type').value,
                    description: document.getElementById('edit-description').value,
                    amount: parseFloat(document.getElementById('edit-amount').value),
                    category: document.getElementById('edit-category').value,
                    date: document.getElementById('edit-date').value,
                    updatedAt: new Date().toISOString()
                };
                
                saveTransactions();
                updateSummary();
                renderTransactions();
                updateCharts();
                closeEditModal();
                showNotification('Transa√ß√£o atualizada com sucesso!', 'success');
            }
        }

        function deleteTransaction(id) {
            if (confirm('Tem certeza que deseja excluir esta transa√ß√£o?')) {
                transactions = transactions.filter(t => t.id !== id);
                saveTransactions();
                updateSummary();
                renderTransactions();
                updateCharts();
                showNotification('Transa√ß√£o exclu√≠da com sucesso!', 'error');
            }
        }

        function closeEditModal() {
            editModal.classList.add('hidden');
            editModal.classList.remove('flex');
        }

        function initCharts() {
            // Gr√°fico de Categorias
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            categoryChart = new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#ef4444', '#f59e0b', '#10b981', '#3b82f6',
                            '#8b5cf6', '#f97316', '#06b6d4', '#84cc16'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });

            // Gr√°fico Mensal
            const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
            monthlyChart = new Chart(monthlyCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Receitas',
                        data: [],
                        borderColor: '#10b981',
                        backgroundColor: '#10b981',
                        tension: 0.4
                    }, {
                        label: 'Despesas',
                        data: [],
                        borderColor: '#ef4444',
                        backgroundColor: '#ef4444',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toFixed(0);
                                }
                            }
                        }
                    }
                }
            });

            updateCharts();
        }

        function updateCharts() {
            const filteredTransactions = getFilteredTransactions();
            
            // Atualizar gr√°fico de categorias
            const categoryData = {};
            const categoryNames = {
                alimentacao: 'Alimenta√ß√£o',
                transporte: 'Transporte',
                moradia: 'Moradia',
                saude: 'Sa√∫de',
                educacao: 'Educa√ß√£o',
                lazer: 'Lazer',
                trabalho: 'Trabalho',
                outros: 'Outros'
            };

            filteredTransactions
                .filter(t => t.type === 'expense')
                .forEach(t => {
                    const categoryName = categoryNames[t.category] || 'Outros';
                    categoryData[categoryName] = (categoryData[categoryName] || 0) + t.amount;
                });

            categoryChart.data.labels = Object.keys(categoryData);
            categoryChart.data.datasets[0].data = Object.values(categoryData);
            categoryChart.update();

            // Atualizar gr√°fico mensal (√∫ltimos 6 meses)
            const monthlyData = {};
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            // Inicializar √∫ltimos 6 meses
            for (let i = 5; i >= 0; i--) {
                const date = new Date();
                date.setMonth(date.getMonth() - i);
                const monthKey = `${months[date.getMonth()]} ${date.getFullYear()}`;
                monthlyData[monthKey] = { income: 0, expense: 0 };
            }

            // Agrupar transa√ß√µes por m√™s
            transactions.forEach(t => {
                const date = new Date(t.date);
                const monthKey = `${months[date.getMonth()]} ${date.getFullYear()}`;
                if (monthlyData[monthKey]) {
                    monthlyData[monthKey][t.type] += t.amount;
                }
            });

            monthlyChart.data.labels = Object.keys(monthlyData);
            monthlyChart.data.datasets[0].data = Object.values(monthlyData).map(d => d.income);
            monthlyChart.data.datasets[1].data = Object.values(monthlyData).map(d => d.expense);
            monthlyChart.update();
        }

        function exportData() {
            const dataStr = JSON.stringify(transactions, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `financas_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('Dados exportados com sucesso!', 'success');
        }

        function clearAllData() {
            if (confirm('Tem certeza que deseja apagar todos os dados? Esta a√ß√£o n√£o pode ser desfeita.')) {
                transactions = [];
                saveTransactions();
                updateSummary();
                renderTransactions();
                updateCharts();
                showNotification('Todos os dados foram apagados!', 'error');
            }
        }

        function saveTransactions() {
            localStorage.setItem('transactions', JSON.stringify(transactions));
            updateLastUpdate();
        }

        function updateLastUpdate() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('last-update').textContent = `Hoje √†s ${timeString}`;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg text-white font-semibold animate-slide-up ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Fechar modal ao clicar fora
        editModal.addEventListener('click', (e) => {
            if (e.target === editModal) {
                closeEditModal();
            }
        });
    </script>
</body>
</html>

